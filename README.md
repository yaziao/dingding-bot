# ğŸ¤– å¤šä»»åŠ¡æ’­æŠ¥æœºå™¨äºº

ä¸€ä¸ªåŸºäºPythonçš„æ™ºèƒ½å¤šä»»åŠ¡æ’­æŠ¥æœºå™¨äººï¼Œæ”¯æŒå¤©æ°”æ’­æŠ¥ã€çƒ­æœæ¦œå•ç­‰å¤šç§ä¿¡æ¯æ¨é€ï¼Œé€šè¿‡é’‰é’‰æœºå™¨äººå®šæ—¶æ¨é€ç¾åŒ–åçš„ä¿¡æ¯åˆ°é’‰é’‰ç¾¤ã€‚é‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ï¼Œæ–¹ä¾¿æ‰©å±•æ–°çš„æ¨é€ä»»åŠ¡ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸŒ¡ï¸ **å®æ—¶å¤©æ°”æ•°æ®**ï¼šé›†æˆå½©ç‰å¤©æ°”APIï¼Œè·å–å‡†ç¡®çš„å¤©æ°”ä¿¡æ¯
- ğŸ”® **å°æ—¶çº§é¢„æŠ¥**ï¼šæ”¯æŒæœªæ¥2å°æ—¶çš„è¯¦ç»†å¤©æ°”é¢„æŠ¥
- ğŸ”¥ **çƒ­æœæ¦œå•**ï¼šæ”¯æŒå¾®åšçƒ­æœã€çŸ¥ä¹çƒ­æ¦œç­‰å¤šç§çƒ­æœæ•°æ®æº
- ğŸ¤– **é’‰é’‰æœºå™¨äººæ¨é€**ï¼šæ”¯æŒæ–‡æœ¬å’ŒMarkdownæ ¼å¼çš„æ¶ˆæ¯æ¨é€
- â° **å®šæ—¶ä»»åŠ¡è°ƒåº¦**ï¼šå¯é…ç½®ä»»æ„é—´éš”çš„å®šæ—¶æ’­æŠ¥ï¼Œæ”¯æŒæ•´ç‚¹æ‰§è¡Œ
- ğŸ¨ **ç¾åŒ–æ¶ˆæ¯æ ¼å¼**ï¼šä¸°å¯Œçš„emojiå’Œç»“æ„åŒ–å¸ƒå±€
- ğŸ« **ç©ºæ°”è´¨é‡ç›‘æµ‹**ï¼šåŒ…å«AQIã€PM2.5ã€PM10ç­‰ç©ºæ°”è´¨é‡æŒ‡æ ‡
- ğŸ’¡ **æ™ºèƒ½æé†’**ï¼šæ ¹æ®å¤©æ°”çŠ¶å†µæä¾›è´´å¿ƒçš„ç”Ÿæ´»å»ºè®®
- ğŸ“Š **è¯¦ç»†å¤©æ°”ä¿¡æ¯**ï¼šæ¸©åº¦ã€æ¹¿åº¦ã€é£å‘é£é€Ÿã€èƒ½è§åº¦ã€æ°”å‹ç­‰
- ğŸŒ§ï¸ **é™æ°´é¢„è­¦**ï¼šæ™ºèƒ½è¯†åˆ«æœªæ¥é™é›¨è¶‹åŠ¿å¹¶æå‰æé†’
- ğŸ”§ **æ¨¡å—åŒ–æ¶æ„**ï¼šåŸºäºä»»åŠ¡çš„å¯æ‰©å±•æ¶æ„ï¼Œæ–¹ä¾¿æ·»åŠ æ–°åŠŸèƒ½
- ğŸ›¡ï¸ **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.12+
- uv åŒ…ç®¡ç†å™¨

### 2. å®‰è£…ä¾èµ–

```bash
# ä½¿ç”¨uvå®‰è£…ä¾èµ–
uv pip install -e .

# æˆ–ä½¿ç”¨pip
pip install -e .
```

### 3. é…ç½®è®¾ç½®

1. **å¤åˆ¶é…ç½®æ¨¡æ¿**ï¼š
   ```bash
   cp config.example .env
   ```

2. **ç¼–è¾‘é…ç½®æ–‡ä»¶**ï¼Œå¡«å…¥ä»¥ä¸‹ä¿¡æ¯ï¼š
   ```bash
   # å½©ç‰å¤©æ°”APIé…ç½®
   CAIYUN_API_KEY=your_caiyun_api_key_here
   
   # ä½ç½®ä¿¡æ¯ (ç»åº¦,çº¬åº¦)
   LONGITUDE=116.4074
   LATITUDE=39.9042
   
   # é’‰é’‰æœºå™¨äººWebhooké…ç½®
   DINGTALK_WEBHOOK=https://oapi.dingtalk.com/robot/send?access_token=your_access_token_here
   DINGTALK_SECRET=your_secret_here  # å¯é€‰
   
   # åŸå¸‚åç§°
   CITY_NAME=åŒ—äº¬
   ```

### 4. è·å–APIå¯†é’¥å’ŒWebhook

#### å½©ç‰å¤©æ°”API
1. è®¿é—® [å½©ç‰å¤©æ°”å¼€å‘å¹³å°](https://dashboard.caiyunapp.com/)
2. æ³¨å†Œè´¦å·å¹¶åˆ›å»ºåº”ç”¨
3. è·å–APIå¯†é’¥

#### é’‰é’‰æœºå™¨äºº
1. åœ¨é’‰é’‰ç¾¤ä¸­æ·»åŠ "è‡ªå®šä¹‰æœºå™¨äºº"
2. å¤åˆ¶Webhookåœ°å€
3. å¦‚éœ€å®‰å…¨è®¾ç½®ï¼Œå¯å¯ç”¨"åŠ ç­¾"åŠŸèƒ½å¹¶è·å–å¯†é’¥

### 5. è·å–åœ°ç†åæ ‡
- è®¿é—® [é«˜å¾·åœ°å›¾åæ ‡æ‹¾å–å·¥å…·](https://lbs.amap.com/tools/picker)
- æœç´¢ç›®æ ‡åŸå¸‚ï¼Œè·å–ç»çº¬åº¦åæ ‡

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨ä¾¿æ·å¯åŠ¨å™¨ï¼ˆæ¨èï¼‰
```bash
python run.py
```
å¯åŠ¨å™¨ä¼šå¼•å¯¼æ‚¨å®Œæˆé…ç½®å¹¶é€‰æ‹©è¿è¡Œæ¨¡å¼ã€‚

### æ–¹æ³•äºŒï¼šç›´æ¥è¿è¡Œ
```bash
# æµ‹è¯•æ¨¡å¼ï¼ˆå‘é€ä¸€æ¬¡æµ‹è¯•æ¶ˆæ¯ï¼‰
python main.py --test

# æ˜¾ç¤ºæ‰§è¡Œè®¡åˆ’
python main.py --show-schedule

# æ­£å¸¸è¿è¡Œï¼ˆæ ¹æ®é…ç½®æ–‡ä»¶ä¸­çš„cronè¡¨è¾¾å¼æ‰§è¡Œï¼‰
python main.py
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
dingding/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ run.py               # ä¾¿æ·å¯åŠ¨å™¨
â”œâ”€â”€ task_manager.py      # ä»»åŠ¡ç®¡ç†å·¥å…·
â”œâ”€â”€ cron_helper.py       # Cronè¡¨è¾¾å¼è¾…åŠ©å·¥å…·
â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ config.example       # é…ç½®æ–‡ä»¶æ¨¡æ¿
â”œâ”€â”€ README.md           # ä½¿ç”¨è¯´æ˜
â”œâ”€â”€ .gitignore          # Gitå¿½ç•¥æ–‡ä»¶
â”œâ”€â”€ logs/               # æ—¥å¿—ç›®å½•
â””â”€â”€ src/                # æºä»£ç ç›®å½•
    â”œâ”€â”€ __init__.py     # åŒ…åˆå§‹åŒ–
    â”œâ”€â”€ config.py       # é…ç½®ç®¡ç†
    â”œâ”€â”€ weather.py      # å¤©æ°”APIè°ƒç”¨
    â”œâ”€â”€ hotsearch.py    # çƒ­æœAPIè°ƒç”¨
    â”œâ”€â”€ dingtalk.py     # é’‰é’‰æœºå™¨äººæ¨é€
    â”œâ”€â”€ formatter.py    # å¤©æ°”æ¶ˆæ¯æ ¼å¼åŒ–
    â”œâ”€â”€ hotsearch_formatter.py  # çƒ­æœæ¶ˆæ¯æ ¼å¼åŒ–
    â”œâ”€â”€ scheduler.py    # å®šæ—¶ä»»åŠ¡è°ƒåº¦
    â”œâ”€â”€ base/           # åŸºç¡€æ¶æ„
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ task_base.py    # ä»»åŠ¡åŸºç±»
    â”‚   â””â”€â”€ task_manager.py # ä»»åŠ¡ç®¡ç†å™¨
    â””â”€â”€ tasks/          # å…·ä½“ä»»åŠ¡å®ç°
        â”œâ”€â”€ __init__.py
        â”œâ”€â”€ weather_task.py     # å¤©æ°”æ’­æŠ¥ä»»åŠ¡
        â””â”€â”€ hotsearch_task.py   # çƒ­æœæ¦œå•ä»»åŠ¡
```

## ğŸ”§ é…ç½®è¯´æ˜

### åŸºç¡€é…ç½®

| å˜é‡å | å¿…å¡« | æè¿° | ç¤ºä¾‹ |
|--------|------|------|------|
| `CAIYUN_API_KEY` | âœ… | å½©ç‰å¤©æ°”APIå¯†é’¥ | `your_api_key_here` |
| `LONGITUDE` | âœ… | ç›®æ ‡ä½ç½®ç»åº¦ | `116.4074` |
| `LATITUDE` | âœ… | ç›®æ ‡ä½ç½®çº¬åº¦ | `39.9042` |
| `DINGTALK_WEBHOOK` | âœ… | é’‰é’‰æœºå™¨äººWebhookåœ°å€ | `https://oapi.dingtalk.com/robot/send?access_token=xxx` |
| `DINGTALK_SECRET` | âŒ | é’‰é’‰æœºå™¨äººå¯†é’¥ï¼ˆåŠ ç­¾ï¼‰ | `your_secret_here` |
| `CITY_NAME` | âŒ | åŸå¸‚æ˜¾ç¤ºåç§° | `åŒ—äº¬` |

### â° Cronå®šæ—¶ä»»åŠ¡é…ç½®

é¡¹ç›®æ”¯æŒä½¿ç”¨cronè¡¨è¾¾å¼çµæ´»é…ç½®æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´ï¼š

| å˜é‡å | æè¿° | é»˜è®¤å€¼ | ç¤ºä¾‹ |
|--------|------|--------|------|
| `WEATHER_TASK_CRON` | å¤©æ°”æ’­æŠ¥ä»»åŠ¡æ‰§è¡Œæ—¶é—´ | `0 * * * *` | æ¯å°æ—¶æ‰§è¡Œ |
| `WEATHER_TASK_ENABLED` | æ˜¯å¦å¯ç”¨å¤©æ°”ä»»åŠ¡ | `true` | `true/false` |
| `HOTSEARCH_TASK_CRON` | çƒ­æœæ¦œå•ä»»åŠ¡æ‰§è¡Œæ—¶é—´ | `0 */2 * * *` | æ¯2å°æ—¶æ‰§è¡Œ |
| `HOTSEARCH_TASK_ENABLED` | æ˜¯å¦å¯ç”¨çƒ­æœä»»åŠ¡ | `true` | `true/false` |
| `HOTSEARCH_TASK_SOURCE` | çƒ­æœæ•°æ®æº | `weibo` | `weibo/zhihu/douyinç­‰` |

#### æ·»åŠ æ›´å¤šçƒ­æœæº

```bash
# çŸ¥ä¹çƒ­æ¦œ - æ¯å¤©8ç‚¹ã€12ç‚¹ã€18ç‚¹æ‰§è¡Œ
HOTSEARCH_ZHIHU_CRON=0 8,12,18 * * *
HOTSEARCH_ZHIHU_ENABLED=true

# æŠ–éŸ³çƒ­æœ - æ¯4å°æ—¶æ‰§è¡Œ
HOTSEARCH_DOUYIN_CRON=0 */4 * * *
HOTSEARCH_DOUYIN_ENABLED=true
```

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | æè¿° |
|------|------|
| `--test` | æµ‹è¯•æ¨¡å¼ï¼Œå‘é€ä¸€æ¬¡æ¶ˆæ¯åé€€å‡º |
| `--show-schedule` | æ˜¾ç¤ºä»»åŠ¡æ‰§è¡Œè®¡åˆ’å¹¶é€€å‡º |
| `--config` | æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ |

### ğŸ• Cronè¡¨è¾¾å¼è¯´æ˜

Cronè¡¨è¾¾å¼æ ¼å¼ï¼š`åˆ† æ—¶ æ—¥ æœˆ å‘¨`

#### å¸¸ç”¨ç¤ºä¾‹

| Cronè¡¨è¾¾å¼ | è¯´æ˜ |
|------------|------|
| `0 * * * *` | æ¯å°æ—¶æ‰§è¡Œ |
| `0 */2 * * *` | æ¯2å°æ—¶æ‰§è¡Œ |
| `0 8,12,18 * * *` | æ¯å¤©8ç‚¹ã€12ç‚¹ã€18ç‚¹æ‰§è¡Œ |
| `30 6 * * *` | æ¯å¤©æ—©ä¸Š6:30æ‰§è¡Œ |
| `0 9 * * 1-5` | å·¥ä½œæ—¥9ç‚¹æ‰§è¡Œ |
| `*/15 * * * *` | æ¯15åˆ†é’Ÿæ‰§è¡Œ |

#### Cronè¾…åŠ©å·¥å…·

```bash
# æ˜¾ç¤ºå¸¸è§ç¤ºä¾‹
python cron_helper.py examples

# éªŒè¯cronè¡¨è¾¾å¼
python cron_helper.py validate "0 */2 * * *"

# æŸ¥çœ‹ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
python cron_helper.py next "0 8,12,18 * * *"

# è§£é‡Šcronè¡¨è¾¾å¼
python cron_helper.py explain "0 9 * * 1-5"
```

## ğŸ”§ ä»»åŠ¡ç®¡ç†

é¡¹ç›®æ”¯æŒå¤šç§ä»»åŠ¡çš„ç‹¬ç«‹ç®¡ç†ï¼Œå¯ä»¥é€šè¿‡ä»»åŠ¡ç®¡ç†å·¥å…·è¿›è¡Œæ§åˆ¶ï¼š

```bash
# æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
python task_manager.py list

# æµ‹è¯•æ‰€æœ‰ä»»åŠ¡
python task_manager.py test

# æµ‹è¯•ç‰¹å®šä»»åŠ¡
python task_manager.py test --task "å¤©æ°”æ’­æŠ¥"

# å¯ç”¨/ç¦ç”¨ä»»åŠ¡
python task_manager.py enable --task "çƒ­æœæ¦œå•-weibo"
python task_manager.py disable --task "çƒ­æœæ¦œå•-weibo"

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€
python task_manager.py status
```

### é»˜è®¤ä»»åŠ¡

- **å¤©æ°”æ’­æŠ¥**ï¼šè·å–å®æ—¶å¤©æ°”å’Œæœªæ¥2å°æ—¶é¢„æŠ¥
- **çƒ­æœæ¦œå•-weibo**ï¼šè·å–å¾®åšçƒ­æœæ¦œå•

### æ·»åŠ è‡ªå®šä¹‰ä»»åŠ¡

åˆ›å»ºæ–°ä»»åŠ¡åªéœ€è¦ç»§æ‰¿ `TaskBase` ç±»ï¼š

```python
from src.base import TaskBase

class CustomTask(TaskBase):
    def __init__(self, dingtalk_bot):
        super().__init__("è‡ªå®šä¹‰ä»»åŠ¡", dingtalk_bot)
    
    def fetch_data(self):
        # å®ç°æ•°æ®è·å–é€»è¾‘
        return {"data": "your_data"}
    
    def format_message(self, data):
        # å®ç°æ¶ˆæ¯æ ¼å¼åŒ–é€»è¾‘
        return "æ ‡é¢˜", "å†…å®¹"
```

## ğŸ“± æ¶ˆæ¯æ•ˆæœé¢„è§ˆ

### Markdownæ ¼å¼æ¶ˆæ¯
```
## â˜€ï¸ åŒ—äº¬å¤©æ°”å®å†µ

> ğŸ“… æ›´æ–°æ—¶é—´ï¼š2024-01-15 14:00

---

### ğŸŒ¡ï¸ åŸºæœ¬ä¿¡æ¯
- **æ¸©åº¦ï¼š** 15.2Â°C ğŸ˜Š å‡‰çˆ½
- **å¤©æ°”ï¼š** â˜€ï¸ æ™´å¤©  
- **æ¹¿åº¦ï¼š** ğŸ’§ 45.0%
- **é£å‘é£é€Ÿï¼š** ğŸ’¨ è¥¿åŒ—é£ 3.2m/s
- **èƒ½è§åº¦ï¼š** ğŸ‘ï¸ 10.0km
- **æ°”å‹ï¼š** ğŸ”ï¸ 1013.2hPa

### ğŸ« ç©ºæ°”è´¨é‡
- **AQIï¼š** ğŸŸ¢ 35 (ä¼˜)
- **PM2.5ï¼š** ğŸ”¹ 12.5Î¼g/mÂ³
- **PM10ï¼š** ğŸ”¸ 25.0Î¼g/mÂ³

### ğŸ”® æœªæ¥2å°æ—¶é¢„æŠ¥

**ğŸ“… 1å°æ—¶å (15:00)**
- **æ¸©åº¦ï¼š** 16.1Â°C
- **å¤©æ°”ï¼š** â˜€ï¸ æ™´å¤©
- **æ¹¿åº¦ï¼š** ğŸ’§ 42.0%
- **é£å‘é£é€Ÿï¼š** ğŸ’¨ è¥¿åŒ—é£ 3.1m/s

**ğŸ“… 2å°æ—¶å (16:00)**
- **æ¸©åº¦ï¼š** 15.8Â°C
- **å¤©æ°”ï¼š** â›… å¤šäº‘ (å¾®é›¨)
- **æ¹¿åº¦ï¼š** ğŸ’§ 45.0%
- **é£å‘é£é€Ÿï¼š** ğŸ’¨ è¥¿é£ 2.8m/s

### ğŸ’¡ æ¸©é¦¨æç¤º
- ğŸŒˆ å¤©æ°”ä¸é”™ï¼Œé€‚åˆå¤–å‡ºæ´»åŠ¨ï¼
- â˜‚ï¸ æœªæ¥2å°æ—¶å¯èƒ½æœ‰é™é›¨ï¼Œè®°å¾—å¸¦ä¼ï¼
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIè°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥å½©ç‰å¤©æ°”APIå¯†é’¥æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤APIè°ƒç”¨æ¬¡æ•°æ˜¯å¦å·²ç”¨å®Œ
   - æ£€æŸ¥ç½‘ç»œè¿æ¥

2. **é’‰é’‰æ¶ˆæ¯å‘é€å¤±è´¥**
   - éªŒè¯Webhookåœ°å€æ˜¯å¦æ­£ç¡®
   - æ£€æŸ¥æœºå™¨äººæ˜¯å¦è¢«ç§»é™¤
   - ç¡®è®¤åŠ ç­¾å¯†é’¥é…ç½®

3. **åæ ‡è·å–å¤©æ°”å¤±è´¥**
   - ç¡®è®¤ç»çº¬åº¦æ ¼å¼æ­£ç¡®
   - æ£€æŸ¥åæ ‡æ˜¯å¦åœ¨å½©ç‰å¤©æ°”æ”¯æŒèŒƒå›´å†…

### æ—¥å¿—æŸ¥çœ‹

ç¨‹åºä¼šè‡ªåŠ¨ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ï¼š
- æ§åˆ¶å°è¾“å‡ºï¼šå®æ—¶æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
- æ–‡ä»¶æ—¥å¿—ï¼š`logs/weather_bot.log`
- æ—¥å¿—è½®è½¬ï¼šæ¯å¤©ä¸€ä¸ªæ–‡ä»¶ï¼Œä¿ç•™30å¤©

## ğŸ”„ éƒ¨ç½²å»ºè®®

### æœåŠ¡å™¨éƒ¨ç½²
```bash
# ä½¿ç”¨screenæˆ–tmuxä¿æŒåå°è¿è¡Œ
screen -S weather-bot
python main.py --interval 1

# æˆ–ä½¿ç”¨nohup
nohup python main.py --interval 1 > weather_bot.log 2>&1 &
```

### ä½¿ç”¨systemdæœåŠ¡ï¼ˆæ¨èï¼‰
```bash
# åˆ›å»ºæœåŠ¡æ–‡ä»¶
sudo nano /etc/systemd/system/weather-bot.service

# å¯åŠ¨æœåŠ¡
sudo systemctl enable weather-bot
sudo systemctl start weather-bot
```

### Dockeréƒ¨ç½²
```dockerfile
FROM python:3.12-slim
WORKDIR /app
COPY . .
RUN pip install -e .
CMD ["python", "main.py"]
```

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. å‘èµ·Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- [å½©ç‰å¤©æ°”](https://caiyunapp.com/) - æä¾›å‡†ç¡®çš„å¤©æ°”æ•°æ®API
- [é’‰é’‰å¼€æ”¾å¹³å°](https://developers.dingtalk.com/) - æä¾›æœºå™¨äººæ¨é€èƒ½åŠ›
- æ‰€æœ‰å¼€æºä¾èµ–åº“çš„è´¡çŒ®è€…

---

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤Issueï¼ ğŸŒŸ
